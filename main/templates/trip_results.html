{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trip Results</title>
    <style>
        /* styles.css */

#tripResults li {
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 10px;
    background-color: #f9f9f9;
}

#tripResults li a {
    text-decoration: none;
    color: #333;
    font-weight: bold;
}

#tripResults li a:hover {
    color: #FF7300; /* Change to your desired hover color */
}

ul {
    list-style: none; /* Remove bullets */
}

#tripResults{
    position: relative;
    right: 35px;
    width: 99%;
}

.trip-link {
    position: relative;
    top: 20px;
}

.departure-date{
    position: relative;
    left: 255px;
    top: 82px;
}

.departure-time{
    position: relative;
    left: 216px;
    top: 44px;
}

.company-name{
    bottom: 33px;
    position: relative;
    font-size: 23px;
}

.price{
    position: relative;
    left: 210px;
    color: #6284FF;
    bottom: 35px;
    font-size: 23px;
}

.booked-seats{
    position: relative;
    right: 128px;
    top: 40px;
    color: #6284FF;
} 

.features-list{
    bottom: 60px;
    width: 0;
    position: relative;
    right: 45px;
    color: #7a7979;
}


    </style>
</head>
<body>
    <div class="container" style="background: #FF7300; color: white;">
        <p style ="text-align: center; position: relative; top: 20px;" id="originDestinationName"></p>
        <br> 
        <span style="margin: 20px;">sort by: <select>
                <option value="Price">Price</option>
                <option value="Date">Date</option>
                <option value="Time">Time</option>
            </select>
        </span>

        <p style="margin: 20px;">
            12 buses available
        </p>
        <br> 
    </div>

    <ul id="tripResults"></ul>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="{% static 'main/js/access_token.js' %}"></script>
    <script>
        $(document).ready(function() {

            var savedOrigin = localStorage.getItem('origin')
            console.log('savedOrigin', savedOrigin)

            var savedDestination = localStorage.getItem('destination')
            console.log('savedDestination', savedDestination)

            OriginDestinationString = $('#originDestinationName')
            var OriginDestinationText = $('<p></p>')
                .text(savedOrigin + ' To ' + savedDestination)

            OriginDestinationString.append(OriginDestinationText)

            // Retrieve trip data
            var tripsData = JSON.parse(localStorage.getItem('tripResults'));

            function stripDate(dateString) {
                return dateString.replace("T00:00:00Z", "");
            }

            function stripSeconds(timeString) {
                return timeString.split(":").slice(0, 2).join(":");
            }

            // Check if tripsData contains the 'data' key
            if ('data' in tripsData && Array.isArray(tripsData.data)) {
    var tripResultsList = $("#tripResults");
    tripsData.data.forEach(function(trip) {
        var listItem = $("<li></li>");
        var departureDate = stripDate(trip.attributes.departure_date);
        var departureTime = stripSeconds(trip.attributes.departure_time);
        
        // Create a link wrapping the content of the list item
        var link = $("<a></a>").addClass("trip-link").attr("href", "/bus_details.html?id=" + trip.attributes.bus.id);
        
        // Departure Date with class
        var departureDateElement = $("<span></span>").addClass("departure-date").text(departureDate);
        // Departure Time with class
        var departureTimeElement = $("<span></span>").addClass("departure-time").text(departureTime);
        // Details with class
        var details = $("<p></p>").addClass("trip-details")
            .html(" <span class='company-name'>" + trip.attributes.user.company_name + "</span> <span class='price'>" + 'K' + trip.attributes.price + "</span> <span class='booked-seats'>" + trip.attributes.bus.booked_seats_count + ' seats left' + "</span>");
        
        var featuresList = $("<ul></ul>").addClass("features-list");
        var features = trip.attributes.bus.features;
        features.forEach(function(feature, index) {
            featuresList.append($("<li></li>").text(feature.name).css("border", "none"));
            if (index < features.length - 1) {
                featuresList.append(", ");
            }
        });
        
        // Append content to the link
        link.append(departureDateElement, " ", departureTimeElement, "<br>", details, "<br>", featuresList);
        
        // Append the link to the list item
        listItem.append(link);
        
        // Append the list item to the list
        tripResultsList.append(listItem);
    });
    }else {
            console.error("The 'data' key is missing or not an array in tripsData:", tripsData);
        }


            

        });
    </script>
</body>
</html>
